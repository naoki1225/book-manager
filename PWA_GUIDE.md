# スマホで PWA を使用する完全ガイド

## 📱 **ステップバイステップ手順**

### **ステップ 1: 開発サーバーを起動（PC）**

```bash
npm run dev
```

出力例：
```
- Local:        http://localhost:3000
- Network:      http://192.168.1.100:3000  # ← このアドレスを使用
```

### **ステップ 2: PC のIPアドレスを確認**

#### Windows PowerShell
```powershell
ipconfig
```

以下のように出力されます：
```
Ethernet adapter Ethernet:
   IPv4 Address. . . . . . . . . . . : 192.168.1.100  ← コレ
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
```

#### macOS/Linux
```bash
ifconfig | grep "inet "
```

**重要：** PC とスマホが **同じ WiFi** に接続していることを確認してください。

---

### **ステップ 3: スマホでアプリにアクセス**

スマホのブラウザを開いて、以下にアクセス：

```
http://192.168.1.100:3000
```

※ `192.168.1.100` は自分の PC の IP アドレスに置き換えてください

---

### **ステップ 4: ホーム画面に追加（PWA インストール）**

#### **iOS（iPhone/iPad）の場合**

1. Safari で `http://192.168.1.100:3000` を開く
2. 下部の **共有ボタン**（ボックスの上矢印）をタップ
3. 「ホーム画面に追加」をタップ
4. アプリ名を確認（デフォルト：「ホンキ録」）
5. 「追加」をタップ

**完了！** ホーム画面に「ホンキ録」アイコンが追加されます。

#### **Android の場合**

##### Chrome ブラウザ
1. Chrome で `http://192.168.1.100:3000` を開く
2. 右上の **メニュー**（3点）をタップ
3. 「アプリをインストール」または「ホーム画面に追加」をタップ
4. アプリ名を確認
5. 「インストール」をタップ

##### Firefox ブラウザ
1. Firefox で `http://192.168.1.100:3000` を開く
2. 右下の **メニュー**（3本線）をタップ
3. 「ホーム画面に追加」をタップ
4. アプリ名を確認
5. 「追加」をタップ

**完了！** ホーム画面に「ホンキ録」アイコンが追加されます。

---

## 🎯 **インストール後**

### ホーム画面から起動

通常のアプリのように、ホーム画面のアイコンをタップするだけで起動します：

- ブラウザのアドレスバーが表示されない
- ネイティブアプリのような見た目・操作感
- 本を登録・編集・表示できる

### オフライン機能

WiFi が切れても基本的な閲覧機能は動作します（初回アクセス時にキャッシュされたページ）

---

## ⚠️ **トラブルシューティング**

### スマホからアクセスできない

**原因 1: 異なるネットワーク接続**
```
❌ PC: WiFi (192.168.1.100)
❌ スマホ: 4G/LTE
✅ PC: WiFi、スマホ: 同じ WiFi
```

**解決方法:**
1. スマホの WiFi を確認
2. PC と同じ WiFi に接続

**原因 2: ファイアウォールがブロック**

Windows ファイアウォール設定：
1. Windows セキュリティ → ファイアウォール & ネットワーク保護
2. 詳細設定 → 受信の規則
3. 「新しい規則」→ ポート → TCP 3000 を許可

**原因 3: localhost のみでバインド**
- 現在は修正済み（`-H 0.0.0.0` オプション付き）

### インストール画面が表示されない

**原因 1: manifest.json が読み込めていない**
```
F12（開発者ツール）→ Application → Manifest
```

エラーがある場合、`public/manifest.json` を確認

**原因 2: HTTPS が必要**
- ローカルネットワーク（`http://192.168.x.x`）では HTTP でも OK
- インターネット経由の場合は HTTPS が必須

### スマホで本を追加できない

**確認:**
1. Supabase の `.env.local` 設定が正しいか確認
2. Supabase ダッシュボードで `posts` テーブルが存在するか確認

```sql
CREATE TABLE posts (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  book_title TEXT NOT NULL,
  book_author TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## 🚀 **複数人での共有方法**

### **方法 A: 同じ WiFi（最も簡単）**

1. PC で `npm run dev` 実行
2. スマホから `http://192.168.1.100:3000` にアクセス
3. 各自でホーム画面に追加

**メリット:** セットアップ不要、即座に使用可能
**デメリット:** 同じ WiFi 必須、PC の電源が必須

### **方法 B: インターネット経由（外出先でも OK）**

#### Vercel にデプロイ（推奨）

```bash
# 1. GitHub にコミット・プッシュ
git add .
git commit -m "PWA setup complete"
git push origin main

# 2. Vercel で プロジェクト作成
# https://vercel.com → Import Project
# GitHub リポジトリを選択

# 3. 環境変数を設定
# Project Settings → Environment Variables
# - NEXT_PUBLIC_SUPABASE_URL
# - NEXT_PUBLIC_SUPABASE_ANON_KEY

# 4. デプロイ完了！
# 誰でも以下の URL で使用可能：
# https://your-project.vercel.app
```

**メリット:** 誰でも、どこからでもアクセス可能
**デメリット:** Vercel アカウント必須（無料）

#### ngrok を使用（簡易的）

```bash
# グローバルインストール
npm install -g ngrok

# 開発サーバーを起動（別ターミナル）
npm run dev

# ngrok トンネル作成（別ターミナル）
ngrok http 3000
```

表示される URL（例：`https://abc123.ngrok.io`）をスマホで開く

**メリット:** セットアップが簡単
**デメリット:** URL が毎回変わる、無料版は接続時間制限あり

---

## ✅ **チェックリスト**

PWA が正しく機能しているか確認：

### iOS
- [ ] ホーム画面から起動できる
- [ ] ブラウザバーが非表示
- [ ] アプリアイコンが表示
- [ ] 本の登録・編集ができる
- [ ] WiFi 切断後も基本表示可

### Android
- [ ] ホーム画面から起動できる
- [ ] ブラウザバー・ステータスバーが非表示
- [ ] アプリアイコンが表示
- [ ] 本の登録・編集ができる
- [ ] WiFi 切断後も基本表示可

---

## 📊 **開発 vs 本番**

| 項目 | 開発環境 | 本番環境 |
|------|---------|---------|
| コマンド | `npm run dev` | Vercel にデプロイ |
| アクセス | `http://192.168.1.100:3000` | `https://app.vercel.app` |
| ファイアウォール | 設定必須 | 不要 |
| PC 電源 | 必須 | 不要 |
| 複数スマホ | 同 WiFi のみ | 誰でも OK |
| HTTPS | 不要 | 必須 |

---

## 🎓 **次のステップ**

1. ✅ スマホで PWA として使用可能
2. ⏭️ Vercel にデプロイして全員で共有
3. ⏭️ App Store/Google Play に公開（オプション）
